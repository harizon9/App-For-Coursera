var common = require('/tools/common/commonTools');

// to keep track of the windows
var openWin = null;
var prevWin = null;
var backArray =[];

function processBackButton(inParam){
	var iPos = ((backArray.length-2) < 0) ? 0 : (backArray.length-2);
	
	if(iPos >= 0){
		var tmpParams = backArray[iPos];
		
		if(backArray.length>1) {
			backArray.pop();
			common.navHandler(tmpParams);
		}
	}	
}

function windowHandler(inParam){
	backArray.push(inParam.PARAMS);
	
	prevWin = openWin;
	
	openWin = inParam.WIN;
	
	openWin.open();
	
	if(prevWin){
		preWin.close();
		prevWin = null;
	}
}

function handleError(inParam){
	alert('Error handling code here... ');	
}

function loadHomeScreen(inParam){
	
	var lhsScreen = require('ui/windows/home')
	var lhsWindow = lhsScreen.loadHomeWindow();
	windowHandler({WIN:lhsWindow, PARAMS:{TYPE:'HOME'}});
	
}

function loadDetailScreen(inParam){

	
}

function appNavigation(inParam){
	
	switch(inParam.TYPE){
		case 'ERROR':
			handleError(inParam);
			break;
		case 'HOME':
			loadHomeScreen(inParam);
			break;
		case 'DETAIL':
			loadDetailScreen(inParam);
			break;
		case 'STARTAPP':
			startApp();
			break;
		default:
			break;
	}
	
}

function addAppNavListener(){
	Ti.App.addEventListener('APPNAV', appNavigation);
}

function removeAppNavListener(){
	Ti.App.removeEventListener('APPNAV', appNavigation);
}

function startApp(){
	addAppNavListener();
	common.navHandler({TYPE:'HOME'});
}

exports.startApp = startApp;
