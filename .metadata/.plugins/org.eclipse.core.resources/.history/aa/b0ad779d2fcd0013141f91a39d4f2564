var common = require('/tools/common/commonTools');

var openWin = null;
var prevWin = null;
var backArray = [];

function processBackButton(inParam){
	var iPos = ((backArray.length-2) < 0) ? 0 : (backArray.length-2);
	
	if(iPos >= 0){
		var tmpParams = backArray[iPos];
		
		if(backArray.length>1) {
			backArray.pop();
			common.navHandler(tmpParams);
		}
	}	
}

function windowHandler(inParam){
	backArray.push(inParam.WIN);

	prevWin = openWin;

	openWin = inParam.WIN;
	
	openWin.open();
	
	
	
	if(prevWin !== null){
		prevWin.close();
		prevWin = null;
	}
}

function loadErrorW(inParam){
	var loadErrorObject = require('ui/windows/errorWindow');
	var loadErrorWindow = loadErrorObject.loadError();
}

function loadMainMenuW(inParam){
	var loadMainMenuObject = require('ui/windows/mainmenu');
	var loadMainMenuWindow = loadMainMenuObject.loadMainMenu();
	windowHandler({WIN:loadMainMenuWindow, PARAMS:{TYPE:'MAIN_MENU'}});
}

function loadRegisterTaskW(inParam){
	var loadRegisterTaskObject = require('ui/windows/registerTask');
	var loadRegisterTaskWindow = loadRegisterTaskObject .loadRegisterTask();
	windowHandler({WIN:loadRegisterTaskWindow, PARAMS:{TYPE:'REGISTER_TASK'}});
}

function loadInputTimeAvailableW(inParam){
	var loadInputTimeAvailableObject = require('ui/windows/inputTimeAvailable');
	var loadInputTimeAvailableWindow = loadInputTimeAvailableObject.loadInputTimeAvailable();
}

function loadAvailableTasksW(inParam){
	var loadAvailableTasksObject = require('ui/windows/availableTasks');
	var loadAvailableTasksWindow = loadAvailableTasksObject.loadAvailableTasks();
}

function navigateApplication(inParam){
	switch(inParam.TYPE){
		case 'ERROR':
			loadErrorW(inParam);
			break;
		case 'MAIN_MENU':
			loadMainMenuW(inParam);
			break;
		case 'REGISTER_TASK':
			loadRegisterTaskW(inParam);
			break;
		case 'INPUT_TIME_AVAILABLE':
			loadInputTimeAvailableW(inParam);
			break;
		case 'AVAILABLE_TASKS':
			loadAvailableTasksW(inParam);
			break;
		default:
			break;
	}
}

function addNavigateAppListener(){
	Ti.App.addEventListener('APPNAV', navigateApplication);
}

function removeNavigateAppListener(){
	Ti.App.removeEventListener('APPNAV', navigateApplication);
}

function startApplication(){
	addNavigateAppListener();
	common.navHandler({TYPE:'MAIN_MENU'});
}

exports.startApplication = startApplication;
